# Supabase Storage設定チェックリスト

## ✅ 完了済みの設定

### 1. バケット作成
- [x] バケット名: `asset-attachments`
- [x] Public bucket: 有効
- [x] ファイルサイズ制限: 10MB (10485760 bytes)
- [x] 許可されたMIMEタイプ:
  - `image/*` (すべての画像形式)
  - `application/vnd.ms-excel` (Excel .xls)
  - `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet` (Excel .xlsx)
  - `text/csv` (CSV)

### 2. Storageポリシー
- [x] アップロード許可 (INSERT)
- [x] 読み取り許可 (SELECT)
- [x] 削除許可 (DELETE)
- [x] 更新許可 (UPDATE)

### 3. コード実装
- [x] ファイルアップロード機能
- [x] ファイル削除機能
- [x] ファイルURL取得機能
- [x] データベース連携（添付ファイル情報の保存）
- [x] エラーハンドリング
- [x] アップロード進捗表示
- [x] クライアント側ファイルサイズチェック（10MB制限）

## 📋 動作確認項目

### 基本動作
- [ ] 画像ファイル（JPEG, PNG等）のアップロード
- [ ] Excelファイル（.xlsx, .xls）のアップロード
- [ ] CSVファイルのアップロード
- [ ] ファイルの削除
- [ ] ファイルの表示（URL取得）

### エラーハンドリング
- [ ] 10MBを超えるファイルのアップロード拒否
- [ ] 許可されていないファイル形式の拒否
- [ ] ネットワークエラー時の処理

### データ整合性
- [ ] ファイルアップロード時にデータベースに記録が保存される
- [ ] ファイル削除時にデータベースからも削除される
- [ ] 資産削除時に添付ファイルも削除される（CASCADE）

## 🔧 追加設定（オプション）

### 1. CORS設定
通常はSupabaseが自動で設定しますが、カスタムドメインを使用する場合は追加設定が必要です。

### 2. CDN設定
Supabase Storageは自動的にCDN経由で配信されます。追加設定は不要です。

### 3. 画像最適化
必要に応じて、Next.jsのImageコンポーネントと組み合わせて画像最適化が可能です。

### 4. ファイル名の重複チェック
現在はタイムスタンプを追加して重複を回避しています。必要に応じてUUIDを使用することも可能です。

## 🚨 トラブルシューティング

### ファイルがアップロードできない
1. バケットがPublicに設定されているか確認
2. Storageポリシーが正しく設定されているか確認
3. ファイルサイズが10MB以下か確認
4. ブラウザの開発者ツールでエラーを確認

### ファイルが表示できない
1. バケットがPublicに設定されているか確認
2. ファイルパスが正しいか確認
3. Storageポリシーの読み取り許可を確認

### ファイルが削除できない
1. Storageポリシーの削除許可を確認
2. ファイルパスが正しいか確認

## 📝 注意事項

- デモ用途のため、すべてのユーザーが読み書き可能な設定になっています
- 本番環境では、適切な認証とRLSポリシーを実装してください
- ファイルサイズ制限は10MBです。大きなファイルが必要な場合は設定を変更してください
- ストレージ使用量に注意してください（Supabaseの無料プランには制限があります）

